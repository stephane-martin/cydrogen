# Key Exchange

## Usage

### N variant

In the N variant key exchange, the client is not authenticated, and the server is authenticated using its public key.

- The server generates a long-term key pair.
- The client knows the server's public key.
- The client generates session keys and sends a packet with an ephemeral public key to the server.
- The server receives the packet and generates the same session keys on its side.

Server side:

```python
from cydrogen import KxPair

server_kp = KxPair.gen()
print(server_kp.public_key())
```

=> Printed public key: `RvyXqG9WP6nYKQRoIzmnDMvUE5KAnbDNAPXPG8dphi0=`

Client side:
```python
from cydrogen import KxPublicKey, client_init_kx_n

server_public_key = KxPublicKey("RvyXqG9WP6nYKQRoIzmnDMvUE5KAnbDNAPXPG8dphi0=")
session_keys, packet = client_init_kx_n(server_public_key)
```

`session_keys` contains the session keys that the client would use to communicate with the server.
`packet` contains the ephemeral public key and other necessary information to complete the key exchange.
The client can now send the packet to the server.

Server side:
```python
from cydrogen import server_finish_kx_n
session_keys = server_finish_kx_n(server_kp, packet)
```

`session_keys` contains the session keys that the server would use to communicate with the client.
They are the same as the ones generated by the client (only the order of keys rx/tx is reversed).


### KK variant

In the KK variant key exchange, the client and the server authenticate each other using their public keys.

- The client generates a long-term key pair.
- The server generates a long-term key pair.
- The client knows the server's public key, and the server knows the client's public key.
- The client initiates the key exchange by sending a packet with its ephemeral public key to the server.
- The server receives the packet, generates session keys, and sends a packet with its ephemeral public key to the client.
- The client receives the packet and generates the same session keys on its side.

Client side:

```python
from cydrogen import KxPair, KxPublicKey

# client keygen
client_kp = KxPair.gen()
print(client_kp.public_key())
# qkPUJxB+//AFmVb9B40z8lmbh/RK6LyeKLWot57190s=

# client knows server's public key
server_public_key = KxPublicKey("blnFyUVHsJNj9cRGIbhDU04M/Iq7fWL5Aam+IosBQ1s=")

# client initiates key Exchange
s = client_kp.client_init_kx_kk(server_public_key)
# now s.packet1 contains the packet to send to the server

# [client sends s.packet1 to the server]
# [the server will respond with some packet2]

# client calculates session keys
session_keys = s.client_finish_kx_kk(packet2)
```

Server side:

```python
from cydrogen import KxPair, KxPublicKey

# server keygen
server_kp = KxPair.gen()
print(server_kp.public_key())
# blnFyUVHsJNj9cRGIbhDU04M/Iq7fWL5Aam+IosBQ1s=

# server knows client's public key
client_public_key = KxPublicKey("qkPUJxB+//AFmVb9B40z8lmbh/RK6LyeKLWot57190s=")

# [server receives packet1 from the client]

# the server calculates session keys
session_keys, packet2 = server_kp.server_process_kx_kk(client_public_key, packet1)

# [server sends packet2 to the client]
```

## ::: cydrogen.client_init_kx_n
    options:
      show_root_heading: true

## ::: cydrogen.server_finish_kx_n
    options:
      show_root_heading: true

## ::: cydrogen.KxPair
    options:
      heading: "class KxPair"
      show_root_heading: true

## ::: cydrogen.KxPublicKey
    options:
      heading: "class KxPublicKey"
      show_root_heading: true

## ::: cydrogen.KxSecretKey
    options:
      heading: "class KxSecretKey"
      show_root_heading: true

## ::: cydrogen.SessionPair
    options:
      heading: "class SessionPair"
      show_root_heading: true

## ::: cydrogen.KxKkClientState
    options:
      heading: "class KxKkState"
      show_root_heading: true

## ::: cydrogen.Psk
    options:
      heading: "class Psk"
      show_root_heading: true
      inherited_members: true
